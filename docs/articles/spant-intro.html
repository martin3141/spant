<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to spant • Spectroscopy Analysis Tools (spant)</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to spant">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Spectroscopy Analysis Tools (spant)</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/spant-intro.html">Introduction to spant</a>
    </li>
    <li>
      <a href="../articles/spant-preprocessing.html">Common preprocesing steps</a>
    </li>
    <li>
      <a href="../articles/spant-metabolite-simulation.html">Metabolite simulation</a>
    </li>
    <li>
      <a href="../articles/spant-basis-simulation.html">Basis simulation</a>
    </li>
    <li>
      <a href="../articles/abfit-baseline-opts.html">ABfit baseline options</a>
    </li>
    <li>
      <a href="../articles/index.html">Index</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/martin3141/spant/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to spant</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/martin3141/spant/blob/HEAD/vignettes/spant-intro.Rmd" class="external-link"><code>vignettes/spant-intro.Rmd</code></a></small>
      <div class="hidden name"><code>spant-intro.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="reading-raw-data-and-plotting">Reading raw data and plotting<a class="anchor" aria-label="anchor" href="#reading-raw-data-and-plotting"></a>
</h2>
<p>Load the spant package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://spantdoc.wilsonlab.co.uk/" class="external-link">spant</a></span><span class="op">)</span></span></code></pre></div>
<p>Get the path to a data file included with spant:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fname</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"philips_spar_sdat_WS.SDAT"</span>, package <span class="op">=</span> <span class="st">"spant"</span><span class="op">)</span></span></code></pre></div>
<p>Read the file and save to the workspace as <code>mrs_data</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_mrs.html">read_mrs</a></span><span class="op">(</span><span class="va">fname</span><span class="op">)</span></span></code></pre></div>
<p>Output some basic information about the data:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mrs_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; MRS Data Parameters</span></span>
<span><span class="co">#&gt; ----------------------------------</span></span>
<span><span class="co">#&gt; Trans. freq (MHz)       : 127.7861</span></span>
<span><span class="co">#&gt; FID data points         : 1024</span></span>
<span><span class="co">#&gt; X,Y,Z dimensions        : 1x1x1</span></span>
<span><span class="co">#&gt; Dynamics                : 1</span></span>
<span><span class="co">#&gt; Coils                   : 1</span></span>
<span><span class="co">#&gt; Voxel resolution (mm)   : 20x20x20</span></span>
<span><span class="co">#&gt; Sampling frequency (Hz) : 2000</span></span>
<span><span class="co">#&gt; Repetition time (s)     : 2 </span></span>
<span><span class="co">#&gt; Reference freq. (ppm)   : 4.65</span></span>
<span><span class="co">#&gt; Nucleus                 : 1H</span></span>
<span><span class="co">#&gt; Spectral domain         : FALSE</span></span>
<span><span class="co">#&gt; Number of transients    : 128 </span></span>
<span><span class="co">#&gt; Echo time (s)           : 0.03 </span></span>
<span><span class="co">#&gt; Manufacturer            : Philips</span></span></code></pre></div>
<p>Plot the spectral region between 5 and 0.5 ppm:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mrs_data</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="spant-intro_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="basic-preprocessing">Basic preprocessing<a class="anchor" aria-label="anchor" href="#basic-preprocessing"></a>
</h2>
<p>Apply a HSVD filter to the residual water region and align the
spectrum to the tNAA resonance at 2.01 ppm:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mrs_proc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hsvd_filt.html">hsvd_filt</a></span><span class="op">(</span><span class="va">mrs_data</span><span class="op">)</span></span>
<span><span class="va">mrs_proc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/align.html">align</a></span><span class="op">(</span><span class="va">mrs_proc</span>, <span class="fl">2.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mrs_proc</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="spant-intro_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="basis-simulation">Basis simulation<a class="anchor" aria-label="anchor" href="#basis-simulation"></a>
</h2>
<p>Simulate a typical basis set for short TE brain analysis, print some
basic information and plot:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_basis_1h_brain_press.html">sim_basis_1h_brain_press</a></span><span class="op">(</span><span class="va">mrs_proc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">basis</span><span class="op">)</span></span>
<span><span class="co">#&gt; Basis set parameters</span></span>
<span><span class="co">#&gt; -------------------------------</span></span>
<span><span class="co">#&gt; Trans. freq (MHz)       : 127.8</span></span>
<span><span class="co">#&gt; Data points             : 1024</span></span>
<span><span class="co">#&gt; Sampling frequency (Hz) : 2000</span></span>
<span><span class="co">#&gt; Elements                : 27</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Names</span></span>
<span><span class="co">#&gt; -------------------------------</span></span>
<span><span class="co">#&gt; -CrCH2,Ala,Asp,Cr,GABA,Glc,Gln,</span></span>
<span><span class="co">#&gt; GSH,Glu,GPC,Ins,Lac,Lip09,</span></span>
<span><span class="co">#&gt; Lip13a,Lip13b,Lip20,MM09,MM12,</span></span>
<span><span class="co">#&gt; MM14,MM17,MM20,NAA,NAAG,PCh,</span></span>
<span><span class="co">#&gt; PCr,sIns,Tau</span></span>
<span><span class="fu"><a href="../reference/stackplot.html">stackplot</a></span><span class="op">(</span><span class="va">basis</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0.5</span><span class="op">)</span>, labels <span class="op">=</span> <span class="va">basis</span><span class="op">$</span><span class="va">names</span>, y_offset <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p><img src="spant-intro_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p>Perform ABfit analysis of the processed data
(<code>mrs_proc</code>):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_mrs.html">fit_mrs</a></span><span class="op">(</span><span class="va">mrs_proc</span>, <span class="va">basis</span><span class="op">)</span></span></code></pre></div>
<p>Plot the fit result:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_res</span><span class="op">)</span></span></code></pre></div>
<p><img src="spant-intro_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p>Unscaled amplitudes, CRLB error estimates and other useful fitting
diagnostics, such as SNR, are given in the <code>fit_res</code> results
table:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_res</span><span class="op">$</span><span class="va">res_tab</span></span>
<span><span class="co">#&gt;   X Y Z Dynamic Coil X.CrCH2          Ala          Asp           Cr</span></span>
<span><span class="co">#&gt; 1 1 1 1       1    1       0 8.133802e-06 3.547064e-05 4.026719e-05</span></span>
<span><span class="co">#&gt;           GABA          Glc          Gln          GSH          Glu          GPC</span></span>
<span><span class="co">#&gt; 1 1.697276e-05 2.446591e-06 3.036118e-06 2.228048e-05 6.503219e-05 1.606706e-05</span></span>
<span><span class="co">#&gt;            Ins          Lac        Lip09       Lip13a Lip13b Lip20         MM09</span></span>
<span><span class="co">#&gt; 1 5.906155e-05 5.802244e-06 2.387705e-05 2.670583e-06      0     0 9.630767e-06</span></span>
<span><span class="co">#&gt;           MM12         MM14         MM17         MM20          NAA        NAAG</span></span>
<span><span class="co">#&gt; 1 6.511376e-06 2.603852e-05 2.238403e-05 9.203742e-05 6.011109e-05 1.53653e-05</span></span>
<span><span class="co">#&gt;   PCh          PCr         sIns Tau         tNAA         tCr         tCho</span></span>
<span><span class="co">#&gt; 1   0 2.101921e-05 6.504096e-06   0 7.547639e-05 6.12864e-05 1.606706e-05</span></span>
<span><span class="co">#&gt;           Glx        tLM09        tLM13        tLM20   X.CrCH2.sd       Ala.sd</span></span>
<span><span class="co">#&gt; 1 6.80683e-05 3.350782e-05 3.522048e-05 9.203742e-05 2.386862e-06 4.343934e-06</span></span>
<span><span class="co">#&gt;         Asp.sd        Cr.sd      GABA.sd       Glc.sd       Gln.sd       GSH.sd</span></span>
<span><span class="co">#&gt; 1 9.235327e-06 3.689004e-06 4.574399e-06 4.421682e-06 5.083001e-06 2.020427e-06</span></span>
<span><span class="co">#&gt;         Glu.sd       GPC.sd       Ins.sd       Lac.sd     Lip09.sd    Lip13a.sd</span></span>
<span><span class="co">#&gt; 1 5.082976e-06 2.602652e-06 2.093225e-06 5.301706e-06 4.119256e-06 1.328304e-05</span></span>
<span><span class="co">#&gt;      Lip13b.sd     Lip20.sd      MM09.sd      MM12.sd      MM14.sd      MM17.sd</span></span>
<span><span class="co">#&gt; 1 6.474468e-06 7.510908e-06 3.827554e-06 4.594028e-06 7.223426e-06 3.811301e-06</span></span>
<span><span class="co">#&gt;        MM20.sd       NAA.sd      NAAG.sd       PCh.sd       PCr.sd      sIns.sd</span></span>
<span><span class="co">#&gt; 1 8.595853e-06 1.017711e-06 1.208984e-06 2.236874e-06 3.084599e-06 7.240069e-07</span></span>
<span><span class="co">#&gt;         Tau.sd      tNAA.sd       tCr.sd      tCho.sd      Glx.sd     tLM09.sd</span></span>
<span><span class="co">#&gt; 1 3.759957e-06 7.031382e-07 5.890482e-07 2.110662e-07 3.16966e-06 1.006794e-06</span></span>
<span><span class="co">#&gt;       tLM13.sd     tLM20.sd    phase       lw       shift      asym</span></span>
<span><span class="co">#&gt; 1 1.573147e-06 3.016809e-06 11.10963 5.023682 -0.00376505 0.1771067</span></span>
<span><span class="co">#&gt;   res.deviance res.niter res.info</span></span>
<span><span class="co">#&gt; 1 7.307671e-05        28        2</span></span>
<span><span class="co">#&gt;                                                        res.message bl_ed_pppm</span></span>
<span><span class="co">#&gt; 1 Relative error between `par' and the solution is at most `ptol'.   2.364083</span></span>
<span><span class="co">#&gt;   max_bl_flex_used    full_res   spec_resid fit_pts ppm_range      SNR      SRR</span></span>
<span><span class="co">#&gt; 1            FALSE 7.75437e-05 7.307671e-05     497       3.8 62.71686 51.33279</span></span>
<span><span class="co">#&gt;        FQN    tNAA_lw     tCr_lw    tCho_lw auto_bl_crit_7 auto_bl_crit_5.901</span></span>
<span><span class="co">#&gt; 1 1.492722 0.04562445 0.05189506 0.05438237      -8.900349          -8.944159</span></span>
<span><span class="co">#&gt;   auto_bl_crit_4.942 auto_bl_crit_4.12 auto_bl_crit_3.425 auto_bl_crit_2.844</span></span>
<span><span class="co">#&gt; 1          -8.977355         -9.000064          -9.013367           -9.02055</span></span>
<span><span class="co">#&gt;   auto_bl_crit_2.364 auto_bl_crit_1.969 auto_bl_crit_1.647 auto_bl_crit_1.384</span></span>
<span><span class="co">#&gt; 1          -9.024177          -9.023462          -9.009854          -8.958654</span></span>
<span><span class="co">#&gt;   auto_bl_crit_1.17 auto_bl_crit_0.997 auto_bl_crit_0.856 auto_bl_crit_0.743</span></span>
<span><span class="co">#&gt; 1         -8.844271          -8.690744           -8.56263          -8.485471</span></span>
<span><span class="co">#&gt;   auto_bl_crit_0.654 auto_bl_crit_0.593 auto_bl_crit_0.558 auto_bl_crit_0.54</span></span>
<span><span class="co">#&gt; 1          -8.447135          -8.430173          -8.423052         -8.420085</span></span>
<span><span class="co">#&gt;   auto_bl_crit_0.532 auto_bl_crit_0.529</span></span>
<span><span class="co">#&gt; 1          -8.418839          -8.418312</span></span></code></pre></div>
<p>Note that signal names appended with “.sd” are the CRLB estimates for
the uncertainty (standard deviation) in the metabolite quantity
estimate. e.g. to calculate the percentage s.d. for tNAA:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_res</span><span class="op">$</span><span class="va">res_tab</span><span class="op">$</span><span class="va">tNAA.sd</span> <span class="op">/</span> <span class="va">fit_res</span><span class="op">$</span><span class="va">res_tab</span><span class="op">$</span><span class="va">tNAA</span> <span class="op">*</span> <span class="fl">100</span></span>
<span><span class="co">#&gt; [1] 0.9316002</span></span></code></pre></div>
<p>Spectral SNR:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_res</span><span class="op">$</span><span class="va">res_tab</span><span class="op">$</span><span class="va">SNR</span></span>
<span><span class="co">#&gt; [1] 62.71686</span></span></code></pre></div>
<p>Linewidth of the tNAA resonance in PPM:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_res</span><span class="op">$</span><span class="va">res_tab</span><span class="op">$</span><span class="va">tNAA_lw</span></span>
<span><span class="co">#&gt; [1] 0.04562445</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="ratios-to-total-creatine">Ratios to total-creatine<a class="anchor" aria-label="anchor" href="#ratios-to-total-creatine"></a>
</h2>
<p>Amplitude estimates measured by the fitting method are essentially
arbitrary unless scaled to a known reference signal. The simplest
approach for proton-MRS is to simply divide all metabolite values by
total-creatine:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_res_tcr_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_amp_ratio.html">scale_amp_ratio</a></span><span class="op">(</span><span class="va">fit_res</span>, <span class="st">"tCr"</span><span class="op">)</span></span>
<span><span class="va">amps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_amps.html">fit_amps</a></span><span class="op">(</span><span class="va">fit_res_tcr_sc</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">amps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;               [,1]</span></span>
<span><span class="co">#&gt; X.CrCH2 0.00000000</span></span>
<span><span class="co">#&gt; Ala     0.13271789</span></span>
<span><span class="co">#&gt; Asp     0.57876852</span></span>
<span><span class="co">#&gt; Cr      0.65703306</span></span>
<span><span class="co">#&gt; GABA    0.27694176</span></span>
<span><span class="co">#&gt; Glc     0.03992062</span></span>
<span><span class="co">#&gt; Gln     0.04953982</span></span>
<span><span class="co">#&gt; GSH     0.36354693</span></span>
<span><span class="co">#&gt; Glu     1.06111932</span></span>
<span><span class="co">#&gt; GPC     0.26216353</span></span>
<span><span class="co">#&gt; Ins     0.96369742</span></span>
<span><span class="co">#&gt; Lac     0.09467424</span></span>
<span><span class="co">#&gt; Lip09   0.38959787</span></span>
<span><span class="co">#&gt; Lip13a  0.04357545</span></span>
<span><span class="co">#&gt; Lip13b  0.00000000</span></span>
<span><span class="co">#&gt; Lip20   0.00000000</span></span>
<span><span class="co">#&gt; MM09    0.15714362</span></span>
<span><span class="co">#&gt; MM12    0.10624504</span></span>
<span><span class="co">#&gt; MM14    0.42486612</span></span>
<span><span class="co">#&gt; MM17    0.36523650</span></span>
<span><span class="co">#&gt; MM20    1.50175914</span></span>
<span><span class="co">#&gt; NAA     0.98082262</span></span>
<span><span class="co">#&gt; NAAG    0.25071302</span></span>
<span><span class="co">#&gt; PCh     0.00000000</span></span>
<span><span class="co">#&gt; PCr     0.34296694</span></span>
<span><span class="co">#&gt; sIns    0.10612625</span></span>
<span><span class="co">#&gt; Tau     0.00000000</span></span>
<span><span class="co">#&gt; tNAA    1.23153565</span></span>
<span><span class="co">#&gt; tCr     1.00000000</span></span>
<span><span class="co">#&gt; tCho    0.26216353</span></span>
<span><span class="co">#&gt; Glx     1.11065914</span></span>
<span><span class="co">#&gt; tLM09   0.54674149</span></span>
<span><span class="co">#&gt; tLM13   0.57468661</span></span>
<span><span class="co">#&gt; tLM20   1.50175914</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="water-reference-scaling-aka-absolute-quantification">Water reference scaling, AKA “absolute-quantification”<a class="anchor" aria-label="anchor" href="#water-reference-scaling-aka-absolute-quantification"></a>
</h2>
<p>A more sophisticated approach to scaling metabolite values involves
the use of a separate water-reference acquisition - which can be
imported in the standard way:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fname_wref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"philips_spar_sdat_W.SDAT"</span>, package <span class="op">=</span> <span class="st">"spant"</span><span class="op">)</span></span>
<span><span class="va">mrs_data_wref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_mrs.html">read_mrs</a></span><span class="op">(</span><span class="va">fname_wref</span><span class="op">)</span></span></code></pre></div>
<p>The following code assumes the voxel contains 100% white matter
tissue and scales the metabolite values into molal (mM) units (mol / kg
tissue water) based on the method described by Gasparovic et al MRM 2006
55(6):1219-26:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_vols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>WM <span class="op">=</span> <span class="fl">100</span>, GM <span class="op">=</span> <span class="fl">0</span>, CSF <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">TE</span> <span class="op">=</span> <span class="fl">0.03</span></span>
<span><span class="va">TR</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">fit_res_molal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_amp_molal_pvc.html">scale_amp_molal_pvc</a></span><span class="op">(</span><span class="va">fit_res</span>, <span class="va">mrs_data_wref</span>, <span class="va">p_vols</span>, <span class="va">TE</span>, <span class="va">TR</span><span class="op">)</span></span>
<span><span class="va">fit_res_molal</span><span class="op">$</span><span class="va">res_tab</span><span class="op">$</span><span class="va">tNAA</span></span>
<span><span class="co">#&gt; [1] 13.9346</span></span></code></pre></div>
<p>An alternative method scales the metabolite values into molar (mM)
units (mol / Litre of tissue) based on assumptions outlined in the
LCModel manual and references therein (section 10.2). This approach may
be preferred when comparing results to those obtained LCModel or
TARQUIN.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_res_molar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_amp_molar.html">scale_amp_molar</a></span><span class="op">(</span><span class="va">fit_res</span>, <span class="va">mrs_data_wref</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_amp_molar(fit_res, mrs_data_wref): Function name</span></span>
<span><span class="co">#&gt; (scale_amp_molar) is missleading and has been replaced with scale_amp_legacy.</span></span>
<span><span class="va">fit_res_molar</span><span class="op">$</span><span class="va">res_tab</span><span class="op">$</span><span class="va">tNAA</span></span>
<span><span class="co">#&gt; [1] 6.826335</span></span></code></pre></div>
<p>Note, while “absolute” units are attractive, a large number of
assumptions about metabolite and water relaxation rates are necessary to
arrive at these mM estimates. If you’re not confident at being able to
justify these assumptions, scaling to a metabolite reference (eg tCr as
above) is going to be a better option in most cases. Simple metabolite
referenced ratios also have the benefit of being more reproducible due
to the simplicity of the approach.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Martin Wilson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
