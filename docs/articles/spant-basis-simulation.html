<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Basis simulation • Spectroscopy Analysis Tools (spant)</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Basis simulation">
<meta property="og:description" content="spant">
<meta property="og:image" content="https://martin3141.github.io/spant/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Spectroscopy Analysis Tools (spant)</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.18.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/spant-intro.html">Introduction to spant</a>
    </li>
    <li>
      <a href="../articles/spant-preprocessing.html">Common preprocesing steps</a>
    </li>
    <li>
      <a href="../articles/spant-metabolite-simulation.html">Metabolite simulation</a>
    </li>
    <li>
      <a href="../articles/spant-basis-simulation.html">Basis simulation</a>
    </li>
    <li>
      <a href="../articles/abfit-baseline-opts.html">ABfit baseline options</a>
    </li>
    <li>
      <a href="../articles/index.html">Index</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/martin3141/spant/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="spant-basis-simulation_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Basis simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/martin3141/spant/blob/master/vignettes/spant-basis-simulation.Rmd"><code>vignettes/spant-basis-simulation.Rmd</code></a></small>
      <div class="hidden name"><code>spant-basis-simulation.Rmd</code></div>

    </div>

    
    
<div id="basis-simulation" class="section level2">
<h2 class="hasAnchor">
<a href="#basis-simulation" class="anchor"></a>Basis simulation</h2>
<p>Basis simulation is necessary step for modern MRS analysis and the this vignette will explain how to achieve this with spant. It is advisable to follow the examples given in the <a href="spant-metabolite-simulation.html">metabolite simulation vignette</a> before following this guide.</p>
<p>Load the spant package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://martin3141.github.io/spant/">spant</a></span><span class="op">)</span></code></pre></div>
<p>A basis set is a collection of signals to be fit to the MRS data. In spant we start with a list of molecular definitions containing the relevant information for each signal - such as chemical shifts and j-coupling values:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mol_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_mol_paras.html">get_mol_paras</a></span><span class="op">(</span><span class="st">"lac"</span><span class="op">)</span>,
                 <span class="fu"><a href="../reference/get_mol_paras.html">get_mol_paras</a></span><span class="op">(</span><span class="st">"naa"</span><span class="op">)</span>,
                 <span class="fu"><a href="../reference/get_mol_paras.html">get_mol_paras</a></span><span class="op">(</span><span class="st">"cr"</span><span class="op">)</span>,
                 <span class="fu"><a href="../reference/get_mol_paras.html">get_mol_paras</a></span><span class="op">(</span><span class="st">"gpc"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>In the next step we convert these chemical properties into a collection of signals (a spant <code>basis_set</code> object) with the <code>sim_basis</code> function. When fitting, the signal parameters (e.g. sampling frequency) and pulse sequence (e.g. echo-time) must match the MRS data acquisition protocol.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">basis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_basis.html">sim_basis</a></span><span class="op">(</span><span class="va">mol_list</span>, pul_seq <span class="op">=</span> <span class="va">seq_slaser_ideal</span>,
                   acq_paras <span class="op">=</span> <span class="fu"><a href="../reference/def_acq_paras.html">def_acq_paras</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">2048</span>, fs <span class="op">=</span> <span class="fl">2000</span>, ft <span class="op">=</span> <span class="fl">127.8e6</span><span class="op">)</span>,
                   TE1 <span class="op">=</span> <span class="fl">0.008</span>, TE2 <span class="op">=</span> <span class="fl">0.011</span>, TE3 <span class="op">=</span> <span class="fl">0.009</span><span class="op">)</span>

<span class="fu"><a href="../reference/stackplot.html">stackplot</a></span><span class="op">(</span><span class="va">basis</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0.5</span><span class="op">)</span>, y_offset <span class="op">=</span> <span class="fl">50</span>, labels <span class="op">=</span> <span class="va">basis</span><span class="op">$</span><span class="va">names</span><span class="op">)</span></code></pre></div>
<p><img src="spant-basis-simulation_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>In 1H MRS broad resonances from lipids and macromolecules are often included in addition to metabolites:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mol_list_mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html">append</a></span><span class="op">(</span><span class="va">mol_list</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_mol_paras.html">get_mol_paras</a></span><span class="op">(</span><span class="st">"MM09"</span>, ft <span class="op">=</span> <span class="fl">127.8e6</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">basis_mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_basis.html">sim_basis</a></span><span class="op">(</span><span class="va">mol_list_mm</span>, pul_seq <span class="op">=</span> <span class="va">seq_slaser_ideal</span>,
                   acq_paras <span class="op">=</span> <span class="fu"><a href="../reference/def_acq_paras.html">def_acq_paras</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">2048</span>, fs <span class="op">=</span> <span class="fl">2000</span>, ft <span class="op">=</span> <span class="fl">127.8e6</span><span class="op">)</span>,
                   TE1 <span class="op">=</span> <span class="fl">0.008</span>, TE2 <span class="op">=</span> <span class="fl">0.011</span>, TE3 <span class="op">=</span> <span class="fl">0.009</span><span class="op">)</span>

<span class="fu"><a href="../reference/stackplot.html">stackplot</a></span><span class="op">(</span><span class="va">basis_mm</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0.5</span><span class="op">)</span>, y_offset <span class="op">=</span> <span class="fl">50</span>, labels <span class="op">=</span> <span class="va">basis_mm</span><span class="op">$</span><span class="va">names</span><span class="op">)</span></code></pre></div>
<p><img src="spant-basis-simulation_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>Note the field strength is often required to simulate these broad resonances as their linewidth is usually specified in ppm. spant also includes the functions <code>sim_basis_1h_brain</code> and <code>sim_basis_1h_brain_press</code> to produce commonly used sets of basis signals:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/sim_basis_1h_brain.html">sim_basis_1h_brain</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="../reference/stackplot.html">stackplot</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0.5</span><span class="op">)</span>, y_offset <span class="op">=</span> <span class="fl">20</span>, labels <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">names</span><span class="op">)</span></code></pre></div>
<p><img src="spant-basis-simulation_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>Basis sets can be exported for use with LCModel with the <code>write_basis</code> function, and sim_basis_1h_brain has the option <code>lcm_compat</code> to remove signals that are usually generated within the LCModel package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/sim_basis_1h_brain.html">sim_basis_1h_brain</a></span><span class="op">(</span>lcm_compat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/stackplot.html">stackplot</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0.5</span><span class="op">)</span>, y_offset <span class="op">=</span> <span class="fl">20</span>, labels <span class="op">=</span> <span class="va">.</span><span class="op">$</span><span class="va">names</span><span class="op">)</span></code></pre></div>
<p><img src="spant-basis-simulation_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martin Wilson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
